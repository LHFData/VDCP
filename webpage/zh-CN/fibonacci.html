<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>计数原理可视化-斐波那契数列</title>
    <script type="text/javascript" src="../../library/script/d3.min.js"></script>
    <script type="text/javascript" src="../../library/script/jquery-3.1.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../../library/bootstrap/css/bootstrap.min.css">
    <script type="text/javascript" src="../../library/bootstrap/js/bootstrap.min.js"></script>
    <style type="text/css">
        body {
            position: relative;
        }
        svg.graph {
            position: relative;
            width: 100%;
        }
        circle {
            z-index: 1000;
            stroke: darkgrey;
        }
        path {
            z-index: 0;
<<<<<<< HEAD
=======
            opacity: 0.8;
        }
        div.fi-setd-i {
            position: fixed;
            width: 60px;
            height: 120px;
            left: 0px;
            bottom: 0;
            z-index: 9999;
        }
        div.fi-setd-i:hover {
            background-color: black;
            border-radius: 0 8px 8px 0;
            border: 1px solid azure;
            opacity: 0.5;
        }
        div.fi-setd-i input {
            position: relative;
            transform: rotate(270deg);
            height: 60px;
            width: 100px;
            left: -120px;
            top: 30px;
        }
        @keyframes rangeMoveIn {
            0% {
                left: -120px;
            }
            50% {
                left: -70px;
            }
            100% {
                left: -20px;
            }
        }
        div.fi-setd-i:hover input {
            animation: rangeMoveIn;
            animation-duration: 500ms;
            left: -20px;
        }
        @font-face{
            font-family:WYXinQingNian;
            src:url(../../library/font/WenYue-XinQingNianTi-NC-W8.otf);
>>>>>>> master
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
</head>
<body onresize="resize()">
<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../../index.html" style="font-family: WYXinQingNian">计数原理可视化</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="fibonacci.html" class="active">斐波那契</a></li>
                <li><a href="">杨辉三角</a></li>
                <li><a href="">排列组合</a></li>
                <li><a href="">鸽巢原理</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Language<span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li class="divider"></li>
                        <li><a href="../../webpage/zh-CN/index.html">简体中文</a></li>
                        <li><a href="../../webpage/zh-TW/index.html">繁体中文</a></li>
                        <li><a href="../../webpage/en-US/index.html">English</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div class="fi-setd-i">
    <input type="range" min="0" max="100" onchange="rangeOnChange()"/>
</div>
<script type="text/javascript" src="../../script/fibonacci/sin.js"></script>
<!--<script type="text/javascript">
    //实时获取窗口宽度
    var width;
    var height;
<<<<<<< HEAD
    var elementMarginY = Math.round(height / 30);
    var topMargin = Math.round(height * 0.05);
    var halfT = Math.round(height / 7);
    var svg = d3.select("body").append("svg").classed("graph", true);
    //var span = d3.select("body").append("span").style("font-size", "8px");
=======
    var baseRadious = 5;
    //var span = script.select("body").append("span").style("font-size", "8px");
>>>>>>> master
    resize();
    function resize() {
        width = $(window).width();
        height = $(window).height();
<<<<<<< HEAD
        elementMarginY = Math.round(height / 30);
        topMargin = Math.round(height * 0.05);
        halfT = Math.round(height / 7);
        //span.text(width + ", " + height);
    }
    //生成元素的位置
    function elementPosition(i) {
        var result = {
            i: i,
            x: 0,
            y: 0,

        }
        result.y = Math.round(topMargin + elementMarginY * i);
        result.x = Math.round(Math.round(2 * width / 5) * Math.sin((Math.PI / halfT) * result.y - Math.PI) + width / 2);
        return result;
    }
    //生成原始数列
    var fiData = new Array();
    fiData.push(1);
    fiData.push(1);
    for (var i = 2; i < 30; i++) {
        fiData.push(fiData[i - 2] + fiData[i - 1]);
    }
    svg.style("height", function (d, i) {
        return elementPosition(fiData.length + 1).y + "px";
    });
    //生成两点中位线上点
    function quadraticCurvePoint(i1, i2, r) {
        x1 = elementPosition(i1).x;
        y1 = elementPosition(i1).y;
        x2 = elementPosition(i2).x;
        y2 = elementPosition(i2).y;
        k = (x2 - x1) / (y1 - y2);
        x = (x1 + x2) / 2;
        y = (y1 + y2) / 2;
        cos = Math.sqrt(1 / (1 + k * k));
        sin = cos * k;
        d = distance({
            x: x1,
            y: y1
        }, {
            x: x2,
            y: y2
        });
        var result = {
            x: x + d * Math.pow(-1, i2 - i1) * r * cos,
            y: y + d * Math.pow(-1, i2 - i1) * r * sin,
            i1: i1,
            i2: i2,
            d: d
        }
        return result;
    }
    //计算两点间距离
    function distance(a, b) {
        return Math.round(Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y)));
    }
    //根据数据生成颜色
    function fillColor(d, i) {
        var color = d % 0xffffff;
        var RmG = Math.round(color / 0xffff) - Math.round(color % 0xffff / 0xff);
        var GmB = Math.round(color % 0xffff / 0xff) - Math.round(color % 0xff);
        var BmR = Math.round(color % 0xff) - Math.round(color / 0xffff);
        color += Math.round(RmG * 0xffff + GmB * 0xff + BmR);
        color = color > 0xffffff ? color % 0xffffff : (color < 0x000000 ? color + 0xffffff : color);
        switch (color.toString(16).length) {
            case 0:
                return "#000000";
            case 1:
                return "#00" + color.toString(16) + "00" + color.toString(16);
            case 2:
                return "#" + color.toString(16) + color.toString(16) + color.toString(16);
            case 3:
                return "#00" + color.toString(16) + "0" + color.toString(16);
            case 4:
                return "#00" + color.toString(16);
            case 5:
                return "#0" + color.toString(16);
            case 6:
                return "#" + color.toString(16);
            default:
                return "#000000";
        }
    }
    //图像生成器
    function initialRender(t) {
        var rate = 0.1;
        //生成文字
        svg.selectAll("text").data(fiData).enter().append("text").transition().duration(t).ease(d3.easePolyInOut)
                .text(function (d, i) {
                    return d;
                })
                .attr("x", function (d, i) {
                    return (elementPosition(i).x + 5) + "px";
                })
                .attr("y", function (d, i) {
                    return (elementPosition(i).y - 5) + "px";
                })
                .style("font-size", Math.round(height * 0.025) + "px")
                .style("color", function () {
                    var color;
                    color = Math.round(((height / 2000) * 0xff) % 0xff);
                    var str = "#" + color.toString(16) + color.toString(16) + color.toString(16);
                    return str;
                })
                .attr("id", function (d, i) {
                    return "t" + i.toString();
                });
        //生成线条
        svg.selectAll("path").data(fiData).enter().append("path").transition().duration(t).ease(d3.easePolyInOut).attr("d", function (d, i) {
            var path = d3.path();
            if (i > 1) {
                path.moveTo(elementPosition(i).x, elementPosition(i).y);
                path.quadraticCurveTo(quadraticCurvePoint(i, i - 1, rate).x, quadraticCurvePoint(i, i - 1, rate).y, elementPosition(i - 1).x, elementPosition(i - 1).y);
                path.moveTo(elementPosition(i).x, elementPosition(i).y);
                path.quadraticCurveTo(quadraticCurvePoint(i, i - 2, rate).x, quadraticCurvePoint(i, i - 2, rate).y, elementPosition(i - 2).x, elementPosition(i - 2).y)
            }
            return path.toString();
        }).style("stroke", function (d, i) {
            return fillColor(d, i);
        }).style("fill", "none").style("stroke-width", (1 + Math.round(height / 400)).toString()).attr("id", function (d, i) {
            return "p" + i.toString();
        }).style("z-index", "0");
        //生成圆点
        svg.selectAll("circle").data(fiData).enter().append("circle").transition().duration(t).ease(d3.easePolyInOut)
                .attr("r", "5px")
                .attr("cx", function (d, i) {
                    return elementPosition(i).x + "px";
                })
                .attr("cy", function (d, i) {
                    return elementPosition(i).y + "px";
                })
                .style("fill", function (d, i) {
                    return fillColor(d, i);
                })
                .attr("id", function (d, i) {
                    return "c" + i.toString();
                })
                .style("z-index", "1000");
    }
    initialRender(duration);
    function render(t, c) {
        svg.style("height", function (d, i) {
            return elementPosition(fiData.length + 1).y + "px";
        });
        var rate = c % Math.round(Math.random() * 10) == 0 ? 0.25 * Math.random() : -0.15 * Math.random();
        svg.selectAll("path").data(fiData).transition().duration(t).ease(d3.easeBounceIn).attr("d", function (d, i) {
            var path = d3.path();
            if (i > 1) {
                path.moveTo(elementPosition(i).x, elementPosition(i).y);
                path.quadraticCurveTo(quadraticCurvePoint(i, i - 1, rate).x, quadraticCurvePoint(i, i - 1, rate).y, elementPosition(i - 1).x, elementPosition(i - 1).y);
                path.moveTo(elementPosition(i).x, elementPosition(i).y);
                path.quadraticCurveTo(quadraticCurvePoint(i, i - 2, rate).x, quadraticCurvePoint(i, i - 2, rate).y, elementPosition(i - 2).x, elementPosition(i - 2).y)
            }
            return path.toString();
        }).style("stroke", function (d, i) {
            return fillColor(d, i);
        }).style("fill", "none").style("stroke-width", (1 + Math.round(height / 400)).toString());
        svg.selectAll("text").data(fiData).transition().duration(t).ease(d3.easePolyInOut)
                .text(function (d, i) {
                    return d;
                })
                .attr("x", function (d, i) {
                    return (elementPosition(i).x + 5) + "px";
                })
                .attr("y", function (d, i) {
                    return (elementPosition(i).y - 5) + "px";
                })
                .style("font-size", Math.round(height * 0.025) + "px")
                .style("color", function () {
                    var color;
                    color = 0xff - Math.round(((height / 2000) * 0xff) % 0xff);
                    var str = "#" + color.toString(16) + color.toString(16) + color.toString(16);
                    return str;
                });
        svg.selectAll("circle").data(fiData).transition().duration(t).ease(d3.easePolyInOut)
                .attr("r", function () {
                    var r;
                    r = 5 * height / 500;
                    return r + "px";
                })
                .attr("cx", function (d, i) {
                    return elementPosition(i).x + "px";
                })
                .attr("cy", function (d, i) {
                    return elementPosition(i).y + "px";
                })
                .style("fill", function (d, i) {
                    return fillColor(d, i);
                });
    }
    var count = 0;
    var duration = 999;
    setInterval(function () {
        render(duration, count++);
        if (count == 100000)
            count = 0;
    }, duration * 5);
    var id;
    $(this).scroll(function () {
        //alert($(this).scrollTop() - elementPosition(fiData.length - 30).y);
        if ($(this).scrollTop() - elementPosition(fiData.length - 30).y > elementMarginY) {
            var i = fiData.length;
            fiData.push(fiData[i - 2] + fiData[i - 1]);
            render();
            svg.selectAll("path").data(fiData).exit();
            svg.selectAll("circle").data(fiData).exit();
            svg.selectAll("text").data(fiData).exit();
            initialRender(duration);
            hover();
        }
    });
    function hover() {
        $("circle").hover(function () {
            $(this).attr("r", function () {
                var r;
                r = 9 * height / 500;
                return r + "px";
            }).css("stroke", "red");
            id = $(this).attr("id")
            id = id.replace("c", "p");
            $("path#" + id).css("strokeWidth", (2 + Math.round(height / 400) * 3).toString()).css("stroke", "red");
        }, function () {
            $(this).css("stroke", "darkgrey").attr("r", function () {
                var r;
                r = 5 * height / 500;
                return r + "px";
            });
            id = $(this).attr("id");
            id = id.replace("c", "p");
            $("path#" + id).css("strokeWidth", (1 + Math.round(height / 400) * 1).toString()).css("stroke", $(this).css("fill"));
        });
    }
    hover();
</script>
=======
        //span.text(width + ", " + height);
    }
    var svg = d3.select("body").append("svg").classed("graph", true)
            .style("width", width + "px")
            .style("height", height + "px");
    $("body").css("width", width + "px")
            .css("height", height + "px");
    //
    //
    var fiData = new Array();
    fiData.push({
        x: Math.round(width / 2),
        y: Math.round(height / 2),
        data: 1
    });
    fiData.push({
        x: fiData[0].x + baseRadious,
        y: fiData[0].y + baseRadious,
        data: 1
    });
    var duration = 1000;
    var i;
    for (i = 2; i < 50; i++) {
        fiData[i] = {
            x: 0,
            y: 0,
            data: fiData[i - 1].data + fiData[i - 2].data
        }
        switch (i % 4) {
            case 0:
                fiData[i].x = fiData[i - 1].x - fiData[i].data * baseRadious;
                fiData[i].y = fiData[i - 1].y + fiData[i].data * baseRadious;
                break;
            case 1:
                fiData[i].x = fiData[i - 1].x + fiData[i].data * baseRadious;
                fiData[i].y = fiData[i - 1].y + fiData[i].data * baseRadious;
                break;
            case 2:
                fiData[i].x = fiData[i - 1].x + fiData[i].data * baseRadious;
                fiData[i].y = fiData[i - 1].y - fiData[i].data * baseRadious;
                break;
            case 3:
                fiData[i].x = fiData[i - 1].x - fiData[i].data * baseRadious;
                fiData[i].y = fiData[i - 1].y - fiData[i].data * baseRadious;
                break;
        }
    }
    function render() {
        svg.selectAll("circle").data(fiData).enter()
                .append("circle")
                .attr("cx", function (d, i) {
                    return d.x + "px";
                })
                .attr("cy", function (d, i) {
                    return d.y + "px";
                })
                .attr("r", "3px")
                .style("stroke", "steelblue")
                .style("fill", "steelblue");
        //svg.selectAll("path").data(fiData).enter()
        //        .append("path")
        //        .
    }
    render();
</script>-->
>>>>>>> master
</body>
</html>