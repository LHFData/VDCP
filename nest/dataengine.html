<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <!--标题栏-->
    <title>template</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="../lib/jquery-3.3.1/jquery-3.1.1.min.js"></script>
    <script src="../lib/materialize-0.97.8/js/materialize.min.js"></script>
    <link rel="stylesheet" href="../lib/materialize-0.97.8/css/materialize.min.css"/>
    <script src="../lib/d3-4.7.1/d3.min.js"></script>
    <style type="text/css">
        body {
            background: gray;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <svg class="col s12 m12 l12 grey lighten-5 z-depth-5" id="svg-content" style="height: 800px">
        </svg>
    </div>
</div>
<!--侧边栏-->
<ul id="slide-out" class="side-nav z-depth-5">
    <li>
        <div class="container"><img class="responsive-img" src="../img/logo.png" style="margin: 25px 0"></div>
    </li>
    <li>
        <div class="container">
            <div class="input-field">
                <select id="select-language" onchange="selected_lang()">
                    <option value="zh-cn" selected>简体中文</option>
                    <option value="en">English</option>
                </select>
            </div>
        </div>
    </li>
    <li>
        <div class="divider"></div>
    </li>
    <li>
        <div class="container"><span id="text-catalog"></span></div>
    </li>
    <li id="catalog">
        <!--侧边栏内部折叠目录-->
        <!--修改json-->
        <ul class="collapsible" data-collapsible="accordion"></ul>
    </li>
</ul>
<!--底部按钮-->
<div class="fixed-action-btn toolbar">
    <a class="btn-floating btn-large cyan">
        <i class="large material-icons">menu</i>
    </a>
    <ul>
        <li class="waves-effect waves-light"><a href="#!" class="tooltipped button-collapse" data-activates="slide-out"
                                                id="text-tooltip-sidenav" data-position="top" data-delay="50"><i
                class="material-icons">pageview</i></a></li>
        <li class="waves-effect waves-light"><a href="#info-modal" class="tooltipped" id="text-tooltip-info"
                                                data-position="top" data-delay="50"><i
                class="material-icons">info</i></a></li>
        <li class="waves-effect waves-light"><a href="#help-modal" class="tooltipped" id="text-tooltip-help"
                                                data-position="top" data-delay="50"><i
                class="material-icons">live_help</i></a></li>
    </ul>
</div>
<!--信息及帮助-->
<div id="info-modal" class="modal blue lighten-3">
    <div class="modal-content">
        <h4 id="text-modal-info"></h4>
        <div id="text-fib-0-info"></div>
    </div>
    <div class="modal-footer">
        <a href="fib-1.html" class=" modal-action modal-close waves-effect waves-green btn-flat text-next"></a>
    </div>
</div>
<div id="help-modal" class="modal orange lighten-3">
    <div class="modal-content">
        <h4 id="text-modal-help"></h4>
        <div id="text-fib-0-help"></div>
    </div>
    <div class="modal-footer">
        <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat text-yes"></a>
    </div>
</div>
<!--注意：涉及页面文本的修改要到json里面改-->
<script type="text/javascript">
    /**
     * 控制侧边栏
     */
    $(".button-collapse").sideNav({
        draggable: true
    });
    var isopen = true;
    function switchnav() {
        if (isopen) {
            isopen = false;
            $(".button-collapse").sideNav("show");
        }
        else {
            isopen = true;
            $(".button-collapse").sideNav("hide");
        }
    }
    /**
     * 控制多语言及文本
     */
    var lang;
    var isinitial = true;
    var fib_0_intro;
    var next;
    $(document).ready(function () {
        $('select').material_select();
    });
    var txt = document.cookie.split(";");
    lang = $("#select-language").find("option:selected").val();
    var textjson;
    for (var i = 0; i < txt.length; i++) {
        if (txt[i].match("\{.*\}")) {
            lang = JSON.parse(txt[i]).lang;
        }
    }
    function catalog_id(sect, exam) {
        return "s" + sect + "e" + exam + "id";
    }
    function selected_lang() {
        if (!isinitial) {
            lang = $("#select-language").find("option:selected").val();
        } else isinitial = false;
        $.getJSON("../text/" + lang + ".json", function (data) {
            /**
             * 注意：
             * 每一个文本信息在json中储存后，
             * 都要在如下部分注册，
             * 先后顺序不产生影响。
             */
            textjson = data;
            $("#text-catalog").html(data.catalog);
            $("#text-tooltip-sidenav").attr("data-tooltip", data.tooltip_sidenav);
            $("#text-tooltip-help").attr("data-tooltip", data.tooltip_help);
            $("#text-tooltip-info").attr("data-tooltip", data.tooltip_info);
            $(".text-yes").html(data.yes);
            $("#text-modal-info").html(data.modal_info);
            $("#text-modal-help").html(data.modal_help);
            $("#text-fib-0-info").html(data.fib_0_info);
            $("#text-fib-0-help").html(data.fib_0_help);
            $(".text-next").html(data.next);
            document.title = data.fib_0_title;
            /**
             * 到这里结束
             */
            $(document).ready(function () {
                $('.tooltipped').tooltip({delay: 50});
            });
        });
        $.getJSON("../catalog/" + lang + ".json", function (data) {
            $("#catalog .collapsible").remove();
            $("#catalog").append("<ul class='collapsible' data-collapsible='accordion'></ul>");
            var co_wrapper = $("#catalog .collapsible");
            for (var i = 0; i < data.length; i++) {
                var temp_li = co_wrapper.append("<li id='" + catalog_id(i, 0) + "'></li>");
                temp_li.find("#" + catalog_id(i, 0)).append("<div class='collapsible-header'><a class='waves-effect btn-flat' href='" + data[i].href + "'>" + data[i].text + "</a></div>");
                var temp_inner = temp_li.find("#" + catalog_id(i, 0)).append("<div class='collapsible-body'></div>");
                if (data[i].child != undefined) {
                    var temp_colle = temp_inner.find(".collapsible-body").append("<div class='collection'></div>");
                    for (var j = 0; j < data[i].child.length; j++) {
                        temp_colle.find(".collection").append("<a href='" + data[i].child[j].href + "' class='collection-item waves-effect btn-flat'>" + data[i].child[j].text + "</a>");
                    }
                }
            }
            $(document).ready(function () {
                $('.collapsible').collapsible();
            });
        });
        document.cookie = JSON.stringify({"lang": lang});
    }
    selected_lang();
    $(document).ready(function () {
        // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
        $('.modal').modal();
    });
</script>
<script>
   
    var svg=d3.select("body").select("svg");
    var num=5;
    var height=800;
    var width=1080;
    var Box=new Array(num-1);
    var Ball=new Array(num);
    for(var i=0;i<num;i++){
        if(i<num-1)
        Box[i]=0;
        Ball[i]=1;
    }
    //可将render设成带参函数，传入值为盒子数。
    function render(){
        var updateA=d3.select("svg").selectAll("circle").data(Ball);
        var enterA=updateA.enter();
    enterA.append("circle")//物品创建
         .attr("cx",function(d,i)
        {
            return 200*i+width/4+30;
        })
         .attr("cy",height/2)
         .attr("r",0)
         .attr("stroke","#757575")
         .attr("class",function(d,i){
             return "circle_"+i;
         })
         .transition()
         .duration(1000)
         .attr("r",function(d,i){return num*6;});
         //.classed(function(d,i){return i+"";},true);
    var updateB=d3.select("svg").selectAll("rect").data(Box);
    var enterB=updateB.enter();
    enterB.append("rect")//容器创建
          .attr("x",function(d,i){
             return 200*i+width/8;
            })
          .attr("y",height/2)
          .attr("width",0)
          .attr("height",0)
          .attr("fill","white")
          .attr("stroke","black")
          .attr("class",function(d,i){
              return "rect_"+i;
          })
          .transition()
          .duration(1000)
          .attr("width",function(d,i){return num*12;})
          .attr("height",function(d,i){return num*12});
    }
          //.classed(function(d,i){return i+"";},true);
    function start()//按键事件监听器,主要动作部分
    {
        //var number=d3.select("svg").select("rect.rect_1").attr("x");
        //svg.append("text").attr("x",width/2).attr("y",height/2).attr("front-size",100).text(number);
        for(var i=0;i<Ball.length;i++)
        {
        d3.select("circle.circle_"+i).transition().ease(d3.easeBounce).duration(2000).attr("r",0).attr("cy",height/2+30)
                           .attr("cx",function(){
                               var m=Math.floor(Math.random()*Box.length);
                               Box[m]++;
                               return d3.select("rect.rect_"+m).attr("x");
                            })
                           .remove();
        }    
        d3.selectAll("rect").transition().duration(2500).attr("fill","black");
       
        
        for(var m=0;m<Box.length;m++)
        {
            svg.append("text").attr("x",function(){
            var x=d3.select("rect.rect_"+m).attr("x");
            return x;
        }).attr("y",height/2+70).attr("font-size",10).text(Box[m]);
        }
        //d3.select("text").remove();
        //}
    }
    function back()//还原画面
    {
        
        svg.selectAll("rect").remove();
        svg.selectAll("text").remove();
        for(var i=0;i<Box.length;i++)Box[i]=0;
        render();
    }

//核心补全，置入元素在与容器数不匹配时多余元素的处理。
//解决方案，盒子先绑定数据创建，球根据输入数创建，动作时以盒子数据源绑定球，球多余部分用exit处理。
    function Location(){
        var SizeWidth=400;
        var SizeHeight=300;
        var a=d3.rgb(255,0,0);
        var b=d3.rgb(0,0,255);
        var compute=d3.interpolate(a,b);
        var rects=d3.select("svg")
                    .append("rect")
                    .attr("width",SizeWidth)
                    .attr("height",SizeHeight)
                    .attr("x",width/2)
                    .attr("y",height/2)
                    .attr("fill",compute(0.8));
    }
    function NumEngine2(){
        //随机置盒 定理一
          for(var i=0;i<num-1;i++)
        Box[i]+=Ball[i];
        Box[Math.floor(Math.random()*4)]+=Ball[num-1];
        svg.append("text").attr("x",width/2-200).attr("y",height/12).attr("font-size",height/16).text(Box);
        //定理二
        var Num1=5;
        var Group=4;
        var n=(Num1*Group)+Math.floor(Math.random()*4);
        var BOX=new Array(Num1);
        var BALL=new Array(n);
        for(var i=0;i<BOX.length;i++)BOX[i]=0;
        for(var i=0;i<BALL.length;i++)BALL[i]=1;
        d3.select("svg").selectAll("circle").data(BALL).enter().append("circle")
                        .attr("cx",function(d,i){return width/i;})
                        .attr("cy",height/4)
                        .attr("fill","black")
                        .attr("stroke","white")
                        .attr("r",width/i-30);
        d3.select("svg").selectAll("rect").data(BOX).enter().appendd("circle")
                        .attr("x",function(d,i){return width/i;})
                        .attr("y",height/2)
                        .attr("fill","white")
                        .attr("stroke","black")
                        .attr("width",width/i-30)
                        .attr("height",width/i-30);
    }
    function render2(){
       var Num1=5;
        var Group=4;
        var n=(Num1*Group)+Math.floor(Math.random()*4);
        var BOX=new Array(Num1);
        var BALL=new Array(n);
        for(var i=0;i<BOX.length;i++)BOX[i]=0;
        for(var i=0;i<BALL.length;i++)BALL[i]=1;
        d3.select("svg").selectAll("circle").data(BALL);
        var record=0;
        for(var i=0;i<Group;i++)
        {
            for(var j=0;j<Num1;j++)
            {
            svg.append("circle")
               .attr("cx",function(d,i)
                {
                return width/Num1+100*j;
                })
               .attr("cy",(height/Group)*i+30)
               .attr("r",0)
               .attr("stroke","#757575")
               .attr("fill","black")
               .attr("class",function(d,i){
                return "circle_"+record;
                })
               .transition()
               .duration(1000)
               .attr("r",function(d,i){return Num1*6;});
               record++;
             }
        }
        
        d3.select("svg").selectAll("rect").data(BOX).enter().append("rect")
                        .attr("x",function(d,i){return width/Num1+200*i;})
                        .attr("y",height/4+70)
                        .attr("fill","white")
                        .attr("stroke","black")
                        .attr("width",Num1*12)
                        .attr("height",Num1*12)
                        .attr("class",function(d,i){return "rect_"+i;});
        
    }
     function start2()//按键事件监听器,主要动作部分
    {
        //var number=d3.select("svg").select("rect.rect_1").attr("x");
        //svg.append("text").attr("x",width/2).attr("y",height/2).attr("front-size",100).text(number);
        var me=document.getElementById("num").value;
        for(var i=0;i<20;i++)
        {
        d3.select("circle.circle_"+i).transition().ease(d3.easeBounce).duration(2000).delay(1000).attr("r",0).attr("cy",height/2+30)
                           .attr("cx",function(){
                               var m=Math.floor(Math.random()*5);
                               Box[m]++;
                               return d3.select("rect.rect_"+m).attr("x");
                            })
                           .remove();
        }    
        d3.selectAll("rect").transition().duration(3000).attr("fill","black");
       
        
        for(var m=0;m<5;m++)
        {
            svg.append("text").attr("x",function(){
            var x=d3.select("rect.rect_"+m).attr("x");
            return x;
        }).attr("y",height/2+70).attr("font-size",10).text(Box[m]);
        }
        //d3.select("text").remove();
        //}
    }
   render();
    </script>
</html>